name: Build and Test on Dev

on:
  push:
    branches: dev

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      {{#language_setup.node}}
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: {{node_version}}
      {{/language_setup.node}}

      {{#language_setup.go}}
      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: {{go_version}}
      {{/language_setup.go}}

      {{#language_setup.rust}}
      - name: Set up Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: {{rust_version}}
      {{/language_setup.rust}}

      {{#language_setup.java}}
      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: {{java_version}}
          distribution: temurin
      {{/language_setup.java}}

      {{#language_setup.php}}
      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: {{php_version}}
      {{/language_setup.php}}

      {{#language_setup.dotnet}}
      - name: Set up .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: {{dotnet_version}}
      {{/language_setup.dotnet}}

      {{#install_command}}
      - name: Install dependencies
        run: {{install_command}}
      {{/install_command}}

      {{#build_command}}
      - name: Build project
        run: {{build_command}}
      {{/build_command}}

      {{#test_command}}
      - name: Run tests
        run: {{test_command}}
      {{/test_command}}

      {{#dockerize}}
      - name: Build Docker image
        run: docker compose -f docker/compose.yml build

      - name: Push Docker image (manual step)
        run: echo "Add docker login and push logic if needed"
      {{/dockerize}}

      {{^language_specified}}
      - name: ⚠️ No language specified
        run: |
          echo "You didn't specify a language or stack."
          echo "Please customize this workflow manually to match your environment."
      {{/language_specified}}
